# 灵活的视频压缩脚本

本项目提供了一套强大而灵活的 `bash` 视频压缩脚本，基于 `ffmpeg` 构建。其主要目标是提供智能的、基于场景的压缩方案，同时能保持原始宽高比并简化常见用例。

项目的核心是一个通用的 `video_compress.sh` 脚本。其他脚本只是调用主脚本的快捷方式，为特定需求预设了参数。

## 核心功能

- **智能缩放**: 自动检测视频尺寸，并将其按比例缩小到指定的最大分辨率（如 1080p 或 720p），**同时保持原始宽高比**。不再有拉伸或扭曲的视频。
- **模块化设计**: 单一、强大的 `video_compress.sh` 脚本作为引擎。特定用途的脚本（如 `academic_compress.sh` 和 `short_video_compress.sh`）作为简单易用的包装器。
- **高度可定制**: 主脚本可通过命令行标志完全配置，允许您控制码率、帧率、分辨率、音频质量和编解码器。
- **批量处理**: 所有脚本都会自动查找并处理当前目录下的所有 `MP4`、`MOV` 和 `MKV` 文件。

---

## 快速入门：基于场景的脚本

选择最适合您需求的脚本。所有压缩后的视频都保存在 `./compressed` 目录中。

### 1. 学术与讲座视频压缩

**使用场景:** 压缩博士答辩、Zoom 会议或讲座的录像。在这类视频中，屏幕上的文字和语音必须清晰，但高帧率的动态画面并不重要。

此模式通过降低帧率来积极减小文件大小，这对于演示类视频非常有效。

**脚本:** `./academic_compress.sh`

**压缩逻辑:**
- **分辨率**: 保持宽高比，将最长边缩小至最大 **1080p**。
- **帧率**: **3 fps** (极大减小文件大小，对于幻灯片完全足够)。
- **视频码率**: `500k` (为低帧率下的清晰度优化)。
- **音频码率**: `64k` (确保语音清晰易懂)。

**用法:**
```bash
./academic_compress.sh
```

### 2. 短视频压缩

**使用场景:** 为社交媒体或分享压缩短视频片段，此时文件大小是首要任务，可以接受一定的质量损失。

**脚本:** `./short_video_compress.sh`

**压缩逻辑:**
- **分辨率**: 保持宽高比，将最长边缩小至最大 **720p**。
- **帧率**: **15 fps** (在保持基本流畅度的同时减小文件大小)。
- **视频码率**: `500k` (为获得更小的文件而进行积极压缩)。
- **音频码率**: `32k` (满足基本音频需求)。

**用法:**
```bash
./short_video_compress.sh
```

---

## 高级用法：通用的 `video_compress.sh`

如果您需要更多控制，可以直接调用主脚本并传入自定义参数。这使您可以微调压缩的各个方面。

### 工作原理

脚本会在保持宽高比的同时计算新的尺寸。例如，使用 `--max-res 1080`：
- `1920x1200` 的视频将变为 `1080x675`。
- `1080x1920` (竖屏) 的视频将变为 `607x1080`。
- `1280x720` 的视频将保持 `1280x720`，因为它未超过最大分辨率。

### 可用参数

- `-i, --input-dir`: 包含待处理视频的目录 (默认为 `.`)。
- `-o, --output-dir`: 保存压缩文件的目录 (默认为 `./compressed`)。
- `-r, --max-res`: 最长边的最大分辨率 (例如 `1080`, `720`)。
- `-b, --video-bitrate`: 视频码率 (例如 `500k`, `1000k`)。
- `-f, --framerate`: 视频帧率 (例如 `3`, `15`, `24`)。
- `-a, --audio-bitrate`: 音频码率 (例如 `32k`, `64k`)。
- `-x, --codec`: 视频编解码器 (`h264` 或 `h265`, 默认为 `h264`)。
- `-n, --no-audio`: 设置为 `true` 以移除音轨。

### 示例

将 `~/videos` 目录中的所有视频压缩至最大 1080p 分辨率，并使用 H.265 编解码器以获得更高效率：

```bash
./video_compress.sh -i ~/videos -o ./output_folder -r 1080 -x h265
```

## 环境要求

- **ffmpeg**: 必须已安装并在系统的 PATH 中可用。

您可以通过 Homebrew 在 macOS 上安装它：
```bash
brew install ffmpeg
```
或通过包管理器在 Linux 上安装：
```bash
sudo apt update && sudo apt install ffmpeg
```